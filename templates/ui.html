<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Simple Config Server UI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.9.3/dist/semantic.min.css"
  />
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.9.3/dist/semantic.min.js"></script>

  <style>
    html, body { height: 100%; }
    body{
      margin:0;
      background:#0f1115;
      color:rgba(255,255,255,0.92);
      font-family: "Lato","Helvetica Neue",Arial,Helvetica,sans-serif;
    }

    .app-shell{
      min-height:100%;
      display:flex;
      flex-direction:column;
    }

    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .muted{ color: rgba(255,255,255,0.65); }

    /* HERO HEADER (aligned with simple-secrets-server) */
    .hero-wrap{ padding:14px 14px 0 14px; }
    .hero{
      border-radius:12px;
      padding:18px 18px;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      border:1px solid rgba(255,255,255,0.08);
      box-shadow:0 10px 30px rgba(0,0,0,0.35);
    }
    .hero-inner{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:18px;}
    .hero-title{
      display:flex;
      align-items:center;
      gap:12px;
      margin:0;
      font-size:28px;
      font-weight:780;
      letter-spacing:0.2px;
    }
    .hero-title i.icon{ font-size: 22px; }
    .hero-subtitle{
      margin-top:8px;
      color: rgba(255,255,255,0.72);
      max-width: 1040px;
      line-height: 1.35;
    }

    .hero-right {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 8px;
  min-width: 360px;
}
.stat-row {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  justify-content: flex-end;
}

.pill {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 7px 10px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.04);
  color: rgba(255,255,255,0.86);
  font-size: 12px;
  white-space: nowrap;
}
.pill strong { font-weight: 750; color: rgba(255,255,255,0.92); }

.pill .ui.button {
  margin: 0 !important;
  border-radius: 999px !important;
}

@media (max-width: 900px) {
  .hero-inner { flex-wrap: wrap; }
  .hero-right { align-items: flex-start; min-width: unset; }
  .stat-row { justify-content: flex-start; }
}/* CONTENT */
    .content{
      padding:10px 14px 14px 14px;
      flex:1;
    }

    /* reduce default Semantic UI grid margins (match tighter layout) */
    #main-content.ui.grid{ margin: 0 !important; }
    #main-content.ui.grid > .column{ padding-top: 0.7rem; padding-bottom: 0.7rem; }

    code{
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 8px;
      padding: 0.12em 0.35em;
      color: rgba(255,255,255,0.92);
    }

    /* Cards / segments (match simple-* look) */
    .ui.inverted.segment{
      background: rgba(255,255,255,0.02) !important;
      border: 1px solid rgba(255,255,255,0.08) !important;
      border-radius: 12px !important;
      box-shadow: 0 10px 30px rgba(0,0,0,0.20);
    }

    /* keep the left column (Environments) visible when scrolling */
    #left-column{
      position: sticky;
      top: 10px;
      align-self: flex-start;
    }

    /* headings inside segments */
    .ui.inverted.segment .ui.header,
    .ui.inverted.segment h2,
    .ui.inverted.segment h3,
    .ui.inverted.segment h4{
      color: rgba(255,255,255,0.92) !important;
    }

    /* pre blocks (JSON / exports / preview) */
    pre{
      background: rgba(255,255,255,0.03);
      color: rgba(255,255,255,0.92);
      padding: 10px 12px;
      border-radius: 12px;
      overflow-x: auto;
      font-size: 0.9rem;
      border: 1px solid rgba(255,255,255,0.10);
      font-family: ui-monospace, Menlo, Monaco, "SF Mono", "Fira Code", monospace;
    }

    /* limit height of scrollable content areas */
    #env-json, #env-export, #file-preview, #spring-preview{
      max-height: 33vh;
      overflow-y: auto;
    }

    /* Environment menu tweaks */
    .env-menu{
      background: transparent !important;
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 10px;
      overflow: hidden;
    }
    .env-menu .item{
      color: rgba(255,255,255,0.86) !important;
    }
    .env-menu .item:hover{
      background: rgba(255,255,255,0.04) !important;
    }
    .env-menu .item.active{
      background-color: rgba(33,133,208,0.22) !important; /* Fomantic primary blue */
      color: rgba(255,255,255,0.95) !important;
    }

    /* files list */
    #files-list{
      list-style-type:none;
      padding-left:0;
      margin-left:0;
      color: rgba(255,255,255,0.92);
    }
    #files-list li{
      display:flex;
      align-items:center;
      margin-bottom:0.3rem;
      color: rgba(255,255,255,0.90) !important;
    }
    #files-list li i.file-icon{
      margin-right:0.5rem;
      color: rgba(255,255,255,0.88);
      opacity:0.85;
    }
    #files-list li i.file-icon:hover{ opacity:1; }

    a.file-link{ color: #2dafe1; cursor:pointer; }
    a.file-link:hover{ text-decoration: underline; }

    .files-container{ max-height:33vh; overflow-y:auto; }

    /* ikonová buňka v tabulce Selected environment */
    #selected-env-table td.icon-cell{ width:2.5rem; text-align:center; white-space:nowrap; }
    #selected-env-table td.icon-cell i{ color: rgba(255,255,255,0.88); opacity:0.85; }
    #selected-env-table td.icon-cell i:hover{ opacity:1; }
    #selected-env-table td.value-cell{
      word-break: break-all;
      overflow-wrap: anywhere;
      white-space: normal;
    }

    /* header inside segment + copy icon */
    .segment-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:0.5rem;
      gap: 10px;
    }
    .copy-button{ color: rgba(255,255,255,0.88); opacity:0.7; cursor:pointer; }
    .copy-button:hover{ opacity:1; }

    /* Dark controls (inputs, dropdowns, checkboxes) – copied/adapted from simple-secrets-server */
    :root{
      --ctl-bg: rgba(255,255,255,0.06);
      --ctl-bg-hover: rgba(255,255,255,0.09);
      --ctl-bg-focus: rgba(255,255,255,0.08);
      --ctl-border: rgba(255,255,255,0.14);
      --ctl-border-focus: rgba(255,255,255,0.22);
      --ctl-text: rgba(255,255,255,0.90);
      --ctl-muted: rgba(255,255,255,0.55);
    }

    .ui.input>input,
    .ui.input input,
    .ui.form input[type="text"],
    .ui.form input[type="search"],
    .ui.form input[type="password"],
    .ui.form input[type="email"],
    .ui.form input[type="url"],
    .ui.form textarea,
    input.mono{
      background: var(--ctl-bg) !important;
      color: var(--ctl-text) !important;
      border: 1px solid var(--ctl-border) !important;
      box-shadow: none !important;
      border-radius: 10px !important;
    }

    .ui.input>input::placeholder,
    .ui.input input::placeholder,
    .ui.form input::placeholder,
    .ui.form textarea::placeholder{
      color: var(--ctl-muted) !important;
    }

    .ui.input>input:focus,
    .ui.input input:focus,
    .ui.form input:focus,
    .ui.form textarea:focus,
    input.mono:focus{
      background: var(--ctl-bg-focus) !important;
      border-color: var(--ctl-border-focus) !important;
      box-shadow: 0 0 0 1px rgba(255,255,255,0.06) inset !important;
    }

    .ui.form .field>label{
      color: rgba(255,255,255,0.78) !important;
    }

    /* Dropdowns (if present later) */
    .ui.selection.dropdown,
    .ui.selection.dropdown .menu,
    .ui.dropdown .menu{
      background: rgba(20,22,26,0.98) !important;
      border-color: var(--ctl-border) !important;
      color: var(--ctl-text) !important;
    }
    .ui.selection.dropdown{ background: var(--ctl-bg) !important; }
    .ui.selection.dropdown .text,
    .ui.selection.dropdown .dropdown.icon{
      color: var(--ctl-text) !important;
    }
    .ui.dropdown .menu > .item{
      color: rgba(255,255,255,0.84) !important;
    }
    .ui.dropdown .menu > .item:hover,
    .ui.dropdown .menu > .item.active,
    .ui.dropdown .menu > .item.selected{
      background: rgba(255,255,255,0.08) !important;
      color: rgba(255,255,255,0.95) !important;
    }

    /* Dark checkbox (Fomantic/Semantic) */
    .ui.checkbox label:before{
      background: var(--ctl-bg) !important;
      border: 1px solid var(--ctl-border) !important;
      box-shadow: none !important;
    }
    .ui.checkbox input:focus ~ label:before{
      border-color: var(--ctl-border-focus) !important;
    }
    .ui.checkbox input:checked ~ label:before{
      background: rgba(255,255,255,0.10) !important;
      border-color: var(--ctl-border-focus) !important;
    }
    .ui.checkbox input:checked ~ label:after{
      color: rgba(255,255,255,0.92) !important;
      text-shadow: none !important;
    }

    /* visible scrollbars on dark background */
    pre, .files-container{
      scrollbar-color: #555 rgba(20,22,26,0.98);
      scrollbar-width: thin;
    }
    pre::-webkit-scrollbar, .files-container::-webkit-scrollbar{
      width: 8px;
      height: 8px;
    }
    pre::-webkit-scrollbar-track, .files-container::-webkit-scrollbar-track{
      background: rgba(20,22,26,0.98);
    }
    pre::-webkit-scrollbar-thumb, .files-container::-webkit-scrollbar-thumb{
      background-color: #555;
      border-radius: 4px;
    }
    pre::-webkit-scrollbar-thumb:hover, .files-container::-webkit-scrollbar-thumb:hover{
      background-color: #777;
    }
  </style>
</head>
<body class="ui inverted">
  <div class="app-shell" id="root">
  <!-- HERO HEADER -->
    <div class="hero-wrap">
  <div class="hero">
    <div class="hero-inner">
      <div>
        <div class="hero-title">
          <i class="settings icon"></i>
          Simple Config Server
        </div>
        <div class="hero-subtitle">
          Multi-environment configuration server compatible with Spring Cloud Config,
          with template expansion over environment variables and Git-backed assets.
        </div>
      </div>

      <div class="hero-right">
        <div class="stat-row">
          <div class="pill" title="Number of configured environments">
            envs: <strong id="hero-env-count">-</strong>
          </div>
          <div class="pill" title="Authentication mode">
            auth: <strong id="hero-auth-mode">-</strong>
          </div>
        </div>

        <div class="stat-row">
          <div class="pill" title="Current environment repo head SHA">
            base_sha:
            <strong class="mono" id="hero-base-sha-short">-</strong>
            <button class="ui tiny icon button" id="btnCopyHeroSha" title="Copy full sha">
              <i class="copy icon"></i>
            </button>
          </div>
          <div class="pill" title="Last reload time (client)">
            reloaded: <strong class="mono" id="hero-reloaded-at">-</strong>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

    <!-- CONTENT -->
    <div class="content">
      <div id="main-content" class="ui grid">
    <!-- left column: env list + selected env -->
    <div id="left-column" class="four wide column">
      <div class="ui inverted segment">
        <h3 class="ui header">Environments</h3>
        <div id="env-list" class="ui inverted vertical menu env-menu"></div>
      </div>

      <div class="ui inverted segment">
        <h3 class="ui header">Selected environment</h3>
        <table
          id="selected-env-table"
          class="ui very basic inverted compact table"
        >
          <tbody>
            <tr>
              <td class="icon-cell">
                <i
                  class="id badge outline icon"
                  title="Environment name"
                ></i>
              </td>
              <td class="value-cell" id="env-name"></td>
            </tr>
            <tr>
              <td class="icon-cell">
                <i
                  class="linkify icon"
                  title="Repository URL"
                ></i>
              </td>
              <td class="value-cell" id="env-repo"></td>
            </tr>
            <tr>
              <td class="icon-cell">
                <i
                  class="code branch icon"
                  title="Git branch"
                ></i>
              </td>
              <td class="value-cell" id="env-branch"></td>
            </tr>
            <tr>
              <td class="icon-cell">
                <i
                  class="folder open outline icon"
                  title="Git subpath"
                ></i>
              </td>
              <td class="value-cell" id="env-subpath"></td>
            </tr>
            <tr>
              <td class="icon-cell">
                <i
                  class="terminal icon"
                  title="Working directory"
                ></i>
              </td>
              <td class="value-cell" id="env-workdir"></td>
            </tr>
            <tr>
              <td class="icon-cell">
                <i
                  class="hashtag icon"
                  title="Last commit hash"
                ></i>
              </td>
              <td class="value-cell" id="env-last-commit"></td>
            </tr>
            <tr>
              <td class="icon-cell">
                <i
                  class="clock outline icon"
                  title="Last commit date"
                ></i>
              </td>
              <td class="value-cell" id="env-last-commit-date"></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- right column: env vars + files -->
    <div id="right-column" class="twelve wide column">
      <div class="ui inverted segment">
        <div class="segment-header">
          <h3 class="ui header">Environment variables (JSON)</h3>
          <i
            class="copy icon copy-button"
            title="Copy JSON to clipboard"
            onclick="copyPre('env-json')"
          ></i>
        </div>
        <pre id="env-json">Select environment…</pre>
      </div>

      <div class="ui inverted segment">
        <div class="segment-header">
          <h3 class="ui header">Environment variables as shell exports</h3>
          <i
            class="copy icon copy-button"
            title="Copy exports to clipboard"
            onclick="copyPre('env-export')"
          ></i>
        </div>
        <pre id="env-export">Select environment…</pre>
      </div>

      <div class="ui inverted segment">
        <div class="segment-header">
          <h3 class="ui header">Spring config JSON preview</h3>
          <i
            class="copy icon copy-button"
            title="Copy Spring JSON to clipboard"
            onclick="copyPre('spring-preview')"
          ></i>
        </div>
        <p style="font-size: 0.9rem; opacity: 0.8;">
          Simulates a Spring Cloud Config client call for the currently selected environment.
          Fill in <code>application</code>, <code>profile</code> and optional <code>label</code>.
        </p>
        <form class="ui inverted form" id="spring-form">
          <div class="three fields">
            <div class="field">
              <label>Application</label>
              <input
                type="text"
                id="spring-app"
                placeholder="service-name"
                value=""
              />
            </div>
            <div class="field">
              <label>Profile</label>
              <input
                type="text"
                id="spring-profile"
                placeholder="default"
                value="default"
              />
            </div>
            <div class="field">
              <label>Label (optional)</label>
              <input
                type="text"
                id="spring-label"
                placeholder="main / release / empty"
              />
            </div>
          </div>
          <button class="ui primary button" type="submit">
            Load preview
          </button>
          <span
            id="spring-request-path"
            style="margin-left: 1rem; font-size: 0.85rem; opacity: 0.7;"
          ></span>
        </form>
        <pre id="spring-preview">Select environment and load preview…</pre>
      </div>

      <div class="ui inverted segment">
        <div class="segment-header">
          <h3 class="ui header">Files &amp; templated preview (git repo)</h3>
          <i
            class="copy icon copy-button"
            title="Copy preview to clipboard"
            onclick="copyPre('file-preview')"
          ></i>
        </div>

        <div class="ui two column stackable grid">
          <div class="six wide column">
            <h4 class="ui header">Files</h4>
            <div class="files-container">
              <ul id="files-list" class="ui list">
                <li>No environment selected.</li>
              </ul>
            </div>
          </div>
          <div class="ten wide column">
            <h4 class="ui header">Preview (templated text)</h4>
            <pre id="file-preview">
Click a file to preview its content after template expansion.</pre>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Filled in by the server: UiMeta { base_path, environments[] }
    const META = __META_JSON__;

    function apiBase() {
      if (!META || !META.base_path) return "";
      return META.base_path === "/" ? "" : META.base_path;
    }

    function byEnvName(name) {
      return META.environments.find((e) => e.name === name);
    }

    let currentEnv =
      META && META.environments && META.environments.length > 0
        ? META.environments[0].name
        : null;

    function renderEnvList() {
      const container = document.getElementById("env-list");
      container.innerHTML = "";

      META.environments.forEach((env) => {
        const item = document.createElement("a");
        item.className = "item" + (env.name === currentEnv ? " active" : "");
        item.textContent = env.name;
        item.onclick = () => {
          currentEnv = env.name;
          renderEnvList();
          renderEnvDetails();
          if (META.auth_enabled) {
            loadEnvPanels();
          }
        };
        container.appendChild(item);
      });
    }

    function renderEnvDetails() {
      const env = byEnvName(currentEnv);
      if (!env) {
        return;
      }

      document.getElementById("env-name").textContent = env.name;
      document.getElementById("env-repo").textContent = env.repo_url;
      document.getElementById("env-branch").textContent = env.branch;
      document.getElementById("env-subpath").textContent = env.subpath || "";
      document.getElementById("env-workdir").textContent = env.workdir;
      document.getElementById("env-last-commit").textContent =
        env.last_commit || "";
      document.getElementById("env-last-commit-date").textContent =
        env.last_commit_date || "";


      updateHeroMeta(env);
    }


    function shortSha(sha) {
      if (!sha) return "-";
      const s = String(sha);
      return s.length > 12 ? s.slice(0, 12) : s;
    }

    function formatNowLocal() {
      const d = new Date();
      const pad = (n, len = 2) => String(n).padStart(len, "0");
      return (
        d.getFullYear() +
        "-" +
        pad(d.getMonth() + 1) +
        "-" +
        pad(d.getDate()) +
        " " +
        pad(d.getHours()) +
        ":" +
        pad(d.getMinutes()) +
        ":" +
        pad(d.getSeconds()) +
        "." +
        pad(d.getMilliseconds(), 3)
      );
    }

    let lastHeroShaFull = "";

    function updateHeroMeta(env) {
      const shaFull = env && env.last_commit ? String(env.last_commit) : "";
      lastHeroShaFull = shaFull;

      const shaEl = document.getElementById("hero-base-sha-short");
      if (shaEl) {
        shaEl.textContent = shaFull ? shortSha(shaFull) : "-";
      }

      const relEl = document.getElementById("hero-reloaded-at");
      if (relEl) {
        relEl.textContent = formatNowLocal();
      }
    }

    async function loadEnvPanels() {
      const env = byEnvName(currentEnv);
      if (!env) return;

      const base = apiBase();
      const envName = encodeURIComponent(env.name);

      // /{env}/env
      fetch(`${base}/${envName}/env`)
        .then((r) => (r.ok ? r.json() : Promise.reject(r)))
        .then((data) => {
          document.getElementById("env-json").textContent = JSON.stringify(
            data,
            null,
            2
          );
        })
        .catch(() => {
          document.getElementById("env-json").textContent =
            "Failed to load environment variables.";
        });

      // /{env}/env/export
      fetch(`${base}/${envName}/env/export`)
        .then((r) => (r.ok ? r.text() : Promise.reject(r)))
        .then((text) => {
          document.getElementById("env-export").textContent = text;
        })
        .catch(() => {
          document.getElementById("env-export").textContent =
            "Failed to load export view.";
        });

      // /{env}/assets
      fetch(`${base}/${envName}/assets`)
        .then((r) => (r.ok ? r.json() : Promise.reject(r)))
        .then((data) => {
          const files = (data && data.files) || [];
          const listEl = document.getElementById("files-list");
          listEl.innerHTML = "";
          if (files.length === 0) {
            const li = document.createElement("li");
            li.textContent = "No files found in this environment.";
            listEl.appendChild(li);
            return;
          }

          files.forEach((f) => {
            const li = document.createElement("li");

            const icon = document.createElement("i");
            icon.className = "file outline icon file-icon";
            icon.title = "Config file";
            li.appendChild(icon);

            const a = document.createElement("a");
            a.className = "file-link";
            a.textContent = f;
            a.href = "javascript:void(0)";
            a.onclick = () => previewFile(env, f);
            li.appendChild(a);

            listEl.appendChild(li);
          });
        })
        .catch(() => {
          document.getElementById("files-list").innerHTML =
            "<li>Failed to list files.</li>";
        });
    }

    // Encode a *path* for use inside a URL path segment, but keep '/' as separator.
    // (encodeURIComponent would turn 'src/Makefile' into 'src%2FMakefile', which breaks our backend routing.)
    function encodePathPreserveSlashes(p) {
      const s = String(p || "").replace(/^\/+/, "");
      return s
        .split("/")
        .map((seg) => encodeURIComponent(seg))
        .join("/");
    }

    function previewFile(env, relPath) {
      const base = apiBase();
      const envName = encodeURIComponent(env.name);
      const path = encodePathPreserveSlashes(relPath);

      // Uses the REST-ish assets endpoint: /{env}/assets/{path}
      const url = `${base}/${envName}/assets/${path}`;

      fetch(url)
        .then((r) => r.text())
        .then((text) => {
          document.getElementById("file-preview").textContent = text;
        })
        .catch(() => {
          document.getElementById("file-preview").textContent =
            "Failed to load file.";
        });
    }


    function setupSpringPreview() {
      const form = document.getElementById("spring-form");
      const previewEl = document.getElementById("spring-preview");
      const pathEl = document.getElementById("spring-request-path");
      if (!form || !previewEl || !pathEl) {
        return;
      }

      form.addEventListener("submit", function (e) {
        e.preventDefault();

        const env = byEnvName(currentEnv);
        if (!env) {
          previewEl.textContent = "No environment selected.";
          return;
        }

        const appInput = document.getElementById("spring-app");
        const profileInput = document.getElementById("spring-profile");
        const labelInput = document.getElementById("spring-label");

        const app = (appInput.value || "").trim();
        const profile = (profileInput.value || "").trim() || "default";
        const label = (labelInput.value || "").trim();

        if (!app || !profile) {
          previewEl.textContent = "Application and profile are required.";
          return;
        }

        const base = apiBase();
        const envName = encodeURIComponent(env.name);
        let path = `${base}/${envName}/${encodeURIComponent(app)}/${encodeURIComponent(profile)}`;
        if (label) {
          path += `/${encodeURIComponent(label)}`;
        }

        pathEl.textContent = "GET " + path;
        previewEl.textContent = "Loading...";

        fetch(path, {
          headers: {
            Accept: "application/json",
          },
        })
          .then((r) => {
            if (!r.ok) {
              return r.text().then((t) => {
                throw new Error(
                  "HTTP " + r.status + ": " + (t || r.statusText || "")
                );
              });
            }
            return r.json();
          })
          .then((data) => {
            try {
              previewEl.textContent = JSON.stringify(data, null, 2);
            } catch (e) {
              previewEl.textContent = "Received non-JSON response.";
            }
          })
          .catch((err) => {
            previewEl.textContent = "Error: " + err.message;
          });
      });
    }


    // univerzální copy helper pro <pre> bloky
    function copyPre(id) {
      const pre = document.getElementById(id);
      if (!pre) return;
      const text = pre.textContent || "";

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).catch(() => {});
      } else {
        // fallback pro starší browsery
        const ta = document.createElement("textarea");
        ta.value = text;
        ta.style.position = "fixed";
        ta.style.left = "-9999px";
        document.body.appendChild(ta);
        ta.select();
        try {
          document.execCommand("copy");
        } catch (e) {}
        document.body.removeChild(ta);
      }
    }


    function copyText(text) {
      const t = String(text || "");
      if (!t) return;

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(t).catch(() => {});
      } else {
        const ta = document.createElement("textarea");
        ta.value = t;
        ta.style.position = "fixed";
        ta.style.left = "-9999px";
        document.body.appendChild(ta);
        ta.select();
        try {
          document.execCommand("copy");
        } catch (e) {}
        document.body.removeChild(ta);
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      if (!META || !META.environments || META.environments.length === 0) {
        document.getElementById("main-content").innerHTML =
          "<p>No environments configured in config.yaml.</p>";
        return;
      }

      renderEnvList();
      renderEnvDetails();

      if (META.auth_enabled) {
        // full mode: env JSON, exports, files, preview
        loadEnvPanels();
        setupSpringPreview();
      } else {
        // read-only UI: only environment list & metadata
        const rightCol = document.getElementById("right-column");
        if (rightCol) {
          rightCol.style.display = "none";
        }
        const leftCol = document.getElementById("left-column");
        if (leftCol) {
          leftCol.classList.remove("four", "wide");
          leftCol.classList.add("sixteen", "wide");
        }
      }

        // hero env count
        const envCountEl = document.getElementById("hero-env-count");
        if (envCountEl && META && META.environments) {
          envCountEl.textContent = META.environments.length.toString();
        }

        const authModeEl = document.getElementById("hero-auth-mode");
        if (authModeEl) {
          if (!META.auth_enabled) {
            authModeEl.textContent = "Off";
          } else if (META.basic_auth_enabled && META.client_auth_enabled) {
            authModeEl.textContent = "Basic + ClientId";
          } else if (META.basic_auth_enabled) {
            authModeEl.textContent = "Basic";
          } else if (META.client_auth_enabled) {
            authModeEl.textContent = "ClientId";
          } else {
            authModeEl.textContent = "Custom";
          }

        const copyBtn = document.getElementById("btnCopyHeroSha");
        if (copyBtn) {
          copyBtn.addEventListener("click", (e) => {
            e.preventDefault();
            e.stopPropagation();
            copyText(lastHeroShaFull || "");
          });
        }

        }

    });

  </script>
  </div>
</body>
</html>
